<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">

	<title>CS 319 Cards</title>
	
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" media="all" href="playingCards.ui.css"/>
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
</head>

<body>
	<div class="container">		
		<div class="row" style="background-color:mistyrose;">
			<div class="col-md-10 game">
				<div id="gameBoard"></div>
			</div>
			<div class="col-md-2">
				<div id="legend">
					<h4>Legend</h4>
					<div>
						<div class="yourColor" style="width: 10px; height: 10px; background-color: rgb(92, 133, 255); float: left; margin: 5px;"></div>
						You
					</div>
					<div>
						<div class="theirColor" style="width: 10px; height: 10px; background-color: rgb(255, 169, 113); float: left; margin: 5px;"></div>
						Opp 
					</div>
				</div>
				<div id="score">
					<h4>Sequences</h4>
					<div>You: 0</div>
					<div>Opp: 0</div>
				</div>
				<div id="chat">
					<h4>Chat</h4>
					<div class="chatbox form-control" id="chatbox">

					</div>
					<div id="messageForm">
					    <input class="form-control" id="message" type="text" style="float: left; width: 140px;">
    					<button class="btn btn-default" id="send" type="submit" style="float: right;">Send</button>
    				</div>
				</div>
			</div>
		</div>

		<div class="row" style="background-color:paleturquoise;">
			<div class="col-md-6">
				<h2>Your Hand</h2>
				<div id="yourHand"></div>
			</div>
			<div class="col-md-3">
				<h2>Card Deck</h2>
				<div id="cardDeck">
					<div class="playingCard"></div>
				</div>
			</div>
			<div class="col-md-3">
				<h2>Discard Pile</h2>
				<div id="discard"></div>
			</div>
		</div>
		
		<script type="text/javascript" src="playingCards.js"></script>
		<script type="text/javascript" src="playingCards.ui.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {

				$("#messageForm").width($("#chatbox").outerWidth());

				var cardDeck = $('#gameBoard').playingCards();
				cardDeck.spread();
				
				var hand = [];
				
				var showError = function(msg) {
					$('#error').html(msg).show();
					setTimeout(function() { $('#error').fadeOut('slow'); }, 1000);
				}
				
				var showHand = function() {
					var el = $('#yourHand');
					el.html('');
					for (var i = 0; i < hand.length; i++) {
						el.append(hand[i].getHTML());
					}
					$('#yourHand > .playingCard').each(function(index) {
						$(this).attr('id', 'hand' + index);
					});
				}
				
				var doShuffle = function() {
					cardDeck.shuffle();
					cardDeck.spread();
				}
				
				var doDrawCard = function() {
					if (hand.length == 6) {
						showError('Your hand is full');
						return;
					}
					var c = drawDeck.draw();
					if (!c) {
						showError('No more cards');
						return;
					}
					hand.splice(hand.length, 0, c);
					showHand();
				}
				
				$('#shuffler').click(doShuffle);
				
				$('#draw').click(doDrawCard);
				
				$('#shuffleDraw').click(function() {
					doShuffle();
					doDrawCard();
				});
				
				$('#addCard').click(function() {
					if (!hand.length) {
						showError('Your hand is empty');
						return;
					}
					var c = hand.pop();
					showHand();
					drawDeck.addCard(c);
				});
				
				var drawDeck = new playingCards();
				drawDeck.shuffle();
				doDrawCard();
				doDrawCard();
		 		doDrawCard();
				doDrawCard();
				doDrawCard();
				doDrawCard();
				
				$(document).on('click', '#yourHand > .playingCard', function(card) { 

					var className = card.currentTarget.className.split(" ");
					className = "." + className.join(".");
					if ($(className + ' .front').css("background-color") === "rgb(153, 255, 153)") {
						$(className + ' .front').css("background-color", "#fff");
					}else{
						$(".playingCard .front").not( $(".occupied") ).css("background-color", "rgb(255, 255, 255)");
						$(className + ' .front').css("background-color", "rgb(153, 255, 153)");
					}

				});

				$("#gameBoard > .playingCard").click(function(card){

					if($(" .front", this).css("background-color") === "rgb(153, 255, 153)"){

						if (!hand.length) {
							showError('Your hand is empty');
							return;
						}
						var className = card.currentTarget.className.split(" ");
						className = "." + className.join(".");
						$(className).each(function (index) {
							if($(this).is('[id]')){
								var c = this.id;
								var index = parseInt(c.charAt(4));
								showHand();
								
								clickedElement = hand[index];
								hand.splice(index, 1);
								
								showHand();
								var discard = $('#discard');
								discard.html('');
								discard.html(clickedElement.getHTML());
								doDrawCard();
								$(".playingCard .front").not( $(".occupied" ) ).css("background-color", "rgb(255, 255, 255)");
							}
						})
						$(" .front", this).css("background-color", "rgb(92, 133, 255)");
						//rgb(255, 169, 113) Opponents color
						$(" .front", this).addClass('occupied');
					}

				});
				$("#send").click(function () {
					$("#chatbox").append('<div style="color: rgb(92, 133, 255);">' + 'You: ' + $("#message").val() + '</div>');
					$("#message").val('');
					$('#chatbox').stop().animate({
 						 scrollTop: $("#chatbox")[0].scrollHeight
						}, 800);
					//$("#chatbox").scrollTop($("#chatbox")[0].scrollHeight);
				});
			});
		</script>
	</div>
</body>
</html>
